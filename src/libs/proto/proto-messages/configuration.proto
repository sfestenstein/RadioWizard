/**
 * @file configuration.proto
 * @brief Protocol buffer definitions for application configuration
 *
 * This proto file defines messages for storing and transmitting
 * application configuration, suitable for distributed systems
 * that need to share or synchronize configuration.
 */

syntax = "proto3";

package messages;

option cc_enable_arenas = true;

/**
 * Root configuration message containing all application settings
 */
message ApplicationConfig
{
   // Configuration version for compatibility checking
   int32 version = 1;

   // Name of this configuration profile
   string profile_name = 2;

   // General application settings
   GeneralSettings general = 3;

   // Logging configuration
   LoggingConfig logging = 4;

   // Network configuration
   NetworkConfig network = 5;

   // Feature flags
   FeatureFlags features = 6;

   // Custom settings as key-value pairs
   map<string, string> custom_settings = 7;

   // When this configuration was last modified
   int64 last_modified_ms = 8;

   // Who last modified this configuration
   string modified_by = 9;
}

/**
 * General application settings
 */
message GeneralSettings
{
   // Application name
   string app_name = 1;

   // Environment (development, staging, production)
   string environment = 2;

   // Instance identifier
   string instance_id = 3;

   // Data directory path
   string data_directory = 4;

   // Temp directory path
   string temp_directory = 5;

   // Maximum memory usage in MB (0 = unlimited)
   int64 max_memory_mb = 6;

   // Number of worker threads (0 = auto-detect)
   int32 worker_threads = 7;
}

/**
 * Logging configuration
 */
message LoggingConfig
{
   // Log level
   LogLevel level = 1;

   // Log output targets
   repeated LogOutput outputs = 2;

   // Log format pattern
   string format_pattern = 3;

   // Whether to include timestamps
   bool include_timestamps = 4;

   // Whether to include source location
   bool include_source_location = 5;

   // Maximum log file size in MB before rotation
   int64 max_file_size_mb = 6;

   // Number of rotated files to keep
   int32 max_rotated_files = 7;
}

/**
 * Log levels
 */
enum LogLevel
{
   LOG_LEVEL_TRACE = 0;
   LOG_LEVEL_DEBUG = 1;
   LOG_LEVEL_INFO = 2;
   LOG_LEVEL_WARN = 3;
   LOG_LEVEL_ERROR = 4;
   LOG_LEVEL_CRITICAL = 5;
   LOG_LEVEL_OFF = 6;
}

/**
 * Log output configuration
 */
message LogOutput
{
   // Output type
   LogOutputType type = 1;

   // Path for file output
   string path = 2;

   // Minimum level for this output
   LogLevel min_level = 3;

   // Format override for this output
   string format_override = 4;
}

/**
 * Log output types
 */
enum LogOutputType
{
   LOG_OUTPUT_CONSOLE = 0;
   LOG_OUTPUT_FILE = 1;
   LOG_OUTPUT_SYSLOG = 2;
   LOG_OUTPUT_NETWORK = 3;
}

/**
 * Network configuration
 */
message NetworkConfig
{
   // Server bind address
   string bind_address = 1;

   // Server port
   int32 port = 2;

   // Connection timeout in ms
   int64 connection_timeout_ms = 3;

   // Read timeout in ms
   int64 read_timeout_ms = 4;

   // Write timeout in ms
   int64 write_timeout_ms = 5;

   // Maximum concurrent connections
   int32 max_connections = 6;

   // TLS/SSL configuration
   TlsConfig tls = 7;

   // Retry configuration
   RetryConfig retry = 8;
}

/**
 * TLS configuration
 */
message TlsConfig
{
   // Whether TLS is enabled
   bool enabled = 1;

   // Path to certificate file
   string cert_path = 2;

   // Path to private key file
   string key_path = 3;

   // Path to CA certificate file
   string ca_path = 4;

   // Whether to verify peer certificates
   bool verify_peer = 5;

   // Minimum TLS version (e.g., "1.2", "1.3")
   string min_version = 6;
}

/**
 * Retry configuration
 */
message RetryConfig
{
   // Maximum number of retry attempts
   int32 max_attempts = 1;

   // Initial retry delay in ms
   int64 initial_delay_ms = 2;

   // Maximum retry delay in ms
   int64 max_delay_ms = 3;

   // Multiplier for exponential backoff
   double backoff_multiplier = 4;
}

/**
 * Feature flags for enabling/disabling features
 */
message FeatureFlags
{
   // Individual feature flags
   map<string, bool> flags = 1;

   // Feature configurations with more detail
   repeated FeatureConfig feature_configs = 2;
}

/**
 * Detailed feature configuration
 */
message FeatureConfig
{
   // Feature name
   string name = 1;

   // Whether enabled
   bool enabled = 2;

   // Rollout percentage (0-100)
   int32 rollout_percentage = 3;

   // Specific targets for this feature
   repeated string target_ids = 4;

   // Feature-specific parameters
   map<string, string> parameters = 5;
}
